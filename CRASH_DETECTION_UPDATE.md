# æš´è·Œæ£€æµ‹é€»è¾‘æ›´æ–°è¯´æ˜

## æ›´æ–°æ—¥æœŸ
2026-01-12

## æ›´æ–°å†…å®¹

### ğŸ”¥ ç®€åŒ–è§¦å‘æ¡ä»¶

**æ—§é€»è¾‘**ï¼ˆè¿‡äºä¸¥æ ¼ï¼‰ï¼š
1. å¿…é¡»å…ˆæœ‰å•è¾¹ä¸Šæ¶¨è¶‹åŠ¿ï¼ˆMA20 > MA60 + è¿ç»­Næ ¹ä¸Šæ¶¨Kçº¿ï¼‰
2. ç„¶åä»æœ€é«˜ç‚¹æš´è·Œè¶…è¿‡é˜ˆå€¼
3. å¯¹äºéœ‡è¡è¡Œæƒ…å‡ ä¹ä¸ä¼šè§¦å‘

**æ–°é€»è¾‘**ï¼ˆæ›´å®¹æ˜“è§¦å‘ï¼‰ï¼š
1. âœ… æ£€æµ‹æœ€è¿‘10æ ¹Kçº¿ä¸­ä»»æ„2æ ¹Kçº¿çš„å¹³å‡è·Œå¹…
2. âœ… å¦‚æœå¹³å‡è·Œå¹… >= 0.6%ï¼Œè§¦å‘è½»åº¦æš´è·Œ
3. âœ… å¦‚æœå¹³å‡è·Œå¹… >= 1.2%ï¼Œè§¦å‘ä¸¥é‡æš´è·Œ
4. âœ… ä¸å†è¦æ±‚å•è¾¹ä¸Šæ¶¨è¶‹åŠ¿

## é…ç½®æ›´æ–°

### config.yaml

```yaml
crash_detection:
  enabled: true
  mild_crash_rate: 0.006      # 0.6% è§¦å‘è½»åº¦æš´è·Œ
  severe_crash_rate: 0.012    # 1.2% è§¦å‘ä¸¥é‡æš´è·Œ
  kline_interval: "15m"       # ä½¿ç”¨15åˆ†é’ŸKçº¿
```

## è®¡ç®—é€»è¾‘

### å•æ ¹Kçº¿è·Œå¹…è®¡ç®—
```
è·Œå¹… = (å¼€ç›˜ä»· - æ”¶ç›˜ä»·) / å¼€ç›˜ä»·
```

åªæœ‰æ”¶ç›˜ä»· < å¼€ç›˜ä»·çš„Kçº¿æ‰ç®—ä¸‹è·Œã€‚

### å¹³å‡è·Œå¹…è®¡ç®—
```
å¹³å‡è·Œå¹… = (Kçº¿1è·Œå¹… + Kçº¿2è·Œå¹…) / 2
```

éå†æœ€è¿‘10æ ¹Kçº¿çš„æ‰€æœ‰å¯èƒ½çš„2æ ¹Kçº¿ç»„åˆï¼Œæ‰¾å‡ºæœ€å¤§å¹³å‡è·Œå¹…ã€‚

### ç¤ºä¾‹

**åœºæ™¯1ï¼šæ­£å¸¸éœ‡è¡**
```
Kçº¿1: å¼€ç›˜ 0.14000, æ”¶ç›˜ 0.14002 â†’ æ¶¨å¹… -0.01%ï¼ˆä¸ç®—ï¼‰
Kçº¿2: å¼€ç›˜ 0.14002, æ”¶ç›˜ 0.13998 â†’ è·Œå¹… 0.03%
Kçº¿3: å¼€ç›˜ 0.13998, æ”¶ç›˜ 0.14001 â†’ æ¶¨å¹… -0.02%ï¼ˆä¸ç®—ï¼‰

æœ€å¤§å¹³å‡è·Œå¹…: 0.03%ï¼ˆåªæœ‰1æ ¹ä¸‹è·Œï¼‰
ç»“æœ: âŒ æœªè§¦å‘ï¼ˆéœ€è¦2æ ¹ä¸‹è·ŒKçº¿ï¼‰
```

**åœºæ™¯2ï¼šè½»åº¦æš´è·Œï¼ˆè§¦å‘ï¼‰**
```
Kçº¿1: å¼€ç›˜ 0.14000, æ”¶ç›˜ 0.13902 â†’ è·Œå¹… 0.70%
Kçº¿2: å¼€ç›˜ 0.13902, æ”¶ç›˜ 0.13805 â†’ è·Œå¹… 0.70%

å¹³å‡è·Œå¹…: (0.70% + 0.70%) / 2 = 0.70%
ç»“æœ: âœ… è§¦å‘è½»åº¦æš´è·Œï¼ˆ0.70% > 0.6%ï¼‰
```

**åœºæ™¯3ï¼šä¸¥é‡æš´è·Œï¼ˆè§¦å‘ï¼‰**
```
Kçº¿1: å¼€ç›˜ 0.14000, æ”¶ç›˜ 0.13818 â†’ è·Œå¹… 1.30%
Kçº¿2: å¼€ç›˜ 0.13818, æ”¶ç›˜ 0.13638 â†’ è·Œå¹… 1.30%

å¹³å‡è·Œå¹…: (1.30% + 1.30%) / 2 = 1.30%
ç»“æœ: âœ… è§¦å‘ä¸¥é‡æš´è·Œï¼ˆ1.30% > 1.2%ï¼‰
```

## ä»£ç å˜æ›´

### monitor/crash_detector.go

**1. detect() æ–¹æ³•**
- ç§»é™¤äº†å•è¾¹ä¸Šæ¶¨è¶‹åŠ¿çš„åˆ¤æ–­
- æ”¹ä¸ºéå†æ‰€æœ‰2æ ¹Kçº¿ç»„åˆ
- è®¡ç®—æœ€å¤§å¹³å‡è·Œå¹…

**2. ShouldOpenShort() æ–¹æ³•**
```go
// æ—§é€»è¾‘
return d.currentLevel != CrashNone && d.uptrendCandles >= cfg.MinUptrendCandles

// æ–°é€»è¾‘
return d.currentLevel != CrashNone
```

åªè¦æ£€æµ‹åˆ°æš´è·Œå³å¯å¼€ç©ºä»“ï¼Œä¸å†è¦æ±‚ä¸Šæ¶¨Kçº¿æ•°ã€‚

## æµ‹è¯•ç»“æœ

### æµ‹è¯•æ–‡ä»¶
`monitor/crash_detector_simple_test.go`

### æµ‹è¯•åœºæ™¯

**âœ… åœºæ™¯1ï¼šæ­£å¸¸éœ‡è¡**
- 10æ ¹å°å¹…æ³¢åŠ¨Kçº¿
- æœ€å¤§å¹³å‡è·Œå¹…: 0.02%
- ç»“æœ: æœªè§¦å‘ âœ…

**âœ… åœºæ™¯2ï¼šè½»åº¦æš´è·Œ**
- 2æ ¹Kçº¿å¹³å‡è·Œå¹… 0.7%
- ç»“æœ: è§¦å‘è½»åº¦æš´è·Œ âœ…

**âœ… åœºæ™¯3ï¼šä¸¥é‡æš´è·Œ**
- 2æ ¹Kçº¿å¹³å‡è·Œå¹… 1.3%
- ç»“æœ: è§¦å‘ä¸¥é‡æš´è·Œ âœ…

**âœ… åœºæ™¯4ï¼šåªæœ‰1æ ¹ä¸‹è·Œ**
- åªæœ‰1æ ¹Kçº¿ä¸‹è·Œ 1.0%
- ç»“æœ: æœªè§¦å‘ âœ…

## ä¼˜åŠ¿

### 1. æ›´å®¹æ˜“è§¦å‘
- ä¸å†è¦æ±‚å•è¾¹ä¸Šæ¶¨è¶‹åŠ¿
- ä»»ä½•æ—¶å€™å‡ºç°è¿ç»­ä¸‹è·Œéƒ½ä¼šè§¦å‘
- æ›´é€‚åˆéœ‡è¡è¡Œæƒ…

### 2. æ›´çµæ´»
- ä½¿ç”¨15åˆ†é’ŸKçº¿ï¼Œæ›´é€‚åˆä¸­çŸ­æœŸæ³¢åŠ¨
- å¯ä»¥æ•æ‰åˆ°æ›´å¤šåšç©ºæœºä¼š

### 3. æ›´å®‰å…¨
- ä»ç„¶éœ€è¦2æ ¹Kçº¿éƒ½ä¸‹è·Œ
- é¿å…å•æ ¹Kçº¿çš„è¯¯è§¦å‘
- å¹³å‡è·Œå¹…è®¡ç®—æ›´ç¨³å®š

## ä½¿ç”¨å»ºè®®

### 1. é˜ˆå€¼è°ƒæ•´

**ä¿å®ˆç­–ç•¥**ï¼ˆé™ä½è§¦å‘é¢‘ç‡ï¼‰ï¼š
```yaml
mild_crash_rate: 0.008      # 0.8%
severe_crash_rate: 0.015    # 1.5%
```

**æ¿€è¿›ç­–ç•¥**ï¼ˆå¢åŠ è§¦å‘é¢‘ç‡ï¼‰ï¼š
```yaml
mild_crash_rate: 0.004      # 0.4%
severe_crash_rate: 0.008    # 0.8%
```

### 2. Kçº¿å‘¨æœŸè°ƒæ•´

**çŸ­æœŸäº¤æ˜“**ï¼ˆæ›´é¢‘ç¹ï¼‰ï¼š
```yaml
kline_interval: "5m"        # 5åˆ†é’ŸKçº¿
```

**ä¸­æœŸäº¤æ˜“**ï¼ˆæ›´ç¨³å®šï¼‰ï¼š
```yaml
kline_interval: "1h"        # 1å°æ—¶Kçº¿
```

### 3. ç›‘æ§æ—¥å¿—

å…³æ³¨ä»¥ä¸‹æ—¥å¿—ï¼š
```
ğŸ”»ğŸ”» [æš´è·Œæ£€æµ‹] è½»åº¦æš´è·Œï¼Œæ£€æµ‹åˆ°2æ ¹Kçº¿å¹³å‡è·Œå¹… 0.70%
ğŸ”»ğŸ”»ğŸ”» [æš´è·Œæ£€æµ‹] ä¸¥é‡æš´è·Œï¼æ£€æµ‹åˆ°2æ ¹Kçº¿å¹³å‡è·Œå¹… 1.30%
```

## é£é™©æç¤º

### 1. é¢‘ç¹è§¦å‘
- æ–°é€»è¾‘æ›´å®¹æ˜“è§¦å‘
- å¯èƒ½å¯¼è‡´é¢‘ç¹å¼€ç©ºä»“
- å»ºè®®é…åˆ `max_short_positions` é™åˆ¶ç©ºä»“æ•°é‡

### 2. éœ‡è¡è¡Œæƒ…
- éœ‡è¡è¡Œæƒ…ä¸­å¯èƒ½é¢‘ç¹è§¦å‘
- å»ºè®®è§‚å¯Ÿä¸€æ®µæ—¶é—´åè°ƒæ•´é˜ˆå€¼

### 3. æ‰‹ç»­è´¹
- é¢‘ç¹å¼€å¹³ä»“ä¼šå¢åŠ æ‰‹ç»­è´¹
- ç¡®ä¿ `short_close_rate` è®¾ç½®åˆç†ï¼ˆå»ºè®® >= 0.6%ï¼‰

## è¿è¡Œæµ‹è¯•

```bash
# æµ‹è¯•æ–°çš„æš´è·Œæ£€æµ‹é€»è¾‘
go test -v -run TestSimplifiedCrashDetection ./monitor/...

# æµ‹è¯•ä¸­æ€§ç½‘æ ¼
go test -v -run TestNeutralGridScenario ./position/...
```

## ç›¸å…³é…ç½®

### config.yaml å®Œæ•´é…ç½®

```yaml
# ä¸­æ€§åˆçº¦ç½‘æ ¼é…ç½®
neutral_grid:
  enabled: true
  max_short_positions: 5      # æœ€å¤§5ä¸ªç©ºä»“
  short_close_rate: 0.006     # å¹³ä»“åˆ©æ¶¦ç‡ 0.6%

# æš´è·Œæ£€æµ‹é…ç½®
crash_detection:
  enabled: true
  ma_window: 20
  long_ma_window: 60
  min_uptrend_candles: 2      # å·²åºŸå¼ƒï¼Œä¸å½±å“è§¦å‘
  mild_crash_rate: 0.006      # 0.6% è§¦å‘
  severe_crash_rate: 0.012    # 1.2% è§¦å‘
  kline_interval: "15m"       # 15åˆ†é’ŸKçº¿
```

## æ€»ç»“

âœ… **æ–°é€»è¾‘æ›´å®¹æ˜“è§¦å‘ï¼Œæ›´é€‚åˆå®é™…äº¤æ˜“**

**ä¸»è¦æ”¹è¿›**ï¼š
1. ç§»é™¤äº†å•è¾¹ä¸Šæ¶¨è¶‹åŠ¿çš„è¦æ±‚
2. æ”¹ä¸ºæ£€æµ‹ä»»æ„2æ ¹Kçº¿çš„å¹³å‡è·Œå¹…
3. ä½¿ç”¨15åˆ†é’ŸKçº¿ï¼Œæ›´é€‚åˆä¸­çŸ­æœŸäº¤æ˜“
4. é˜ˆå€¼è®¾ç½®ä¸º0.6%ï¼Œæ›´å®¹æ˜“è§¦å‘

**å»ºè®®**ï¼š
1. å…ˆåœ¨æµ‹è¯•ç¯å¢ƒè¿è¡Œè§‚å¯Ÿ
2. æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é˜ˆå€¼
3. ç›‘æ§æ—¥å¿—ï¼Œè§‚å¯Ÿè§¦å‘é¢‘ç‡
4. é…åˆ `max_short_positions` æ§åˆ¶é£é™©

---

**æ›´æ–°æ—¶é—´**: 2026-01-12  
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡  
**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­ç­‰é£é™©ï¼ˆè§¦å‘æ›´é¢‘ç¹ï¼Œéœ€è¦è§‚å¯Ÿï¼‰

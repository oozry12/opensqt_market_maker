# 应用配置
app:
  current_exchange: "binance"  # 当前使用的交易所: binance, bitget, bybit, gate, edgex

# 多交易所配置
# 
# 🔐 安全提示：API密钥支持两种配置方式（环境变量优先级更高）
#
# 方式1：环境变量（推荐，更安全）
#   设置以下环境变量，程序会自动读取：
#   - BINANCE_API_KEY, BINANCE_SECRET_KEY
#   - BITGET_API_KEY, BITGET_SECRET_KEY, BITGET_PASSPHRASE
#   - GATE_API_KEY, GATE_SECRET_KEY
#   - BYBIT_API_KEY, BYBIT_SECRET_KEY
#
# 方式2：配置文件（不推荐，仅用于测试）
#   直接在下方填写 api_key 和 secret_key
#
# 注意：如果同时设置了环境变量和配置文件，环境变量的值会覆盖配置文件
#
exchanges:
  binance:
  #币安 开户邀请码【OPENSQT】开户链接：https://accounts.maxweb.chat/register?ref=OPENSQT
    api_key: ""               # 或设置环境变量 BINANCE_API_KEY
    secret_key: ""            # 或设置环境变量 BINANCE_SECRET_KEY
    fee_rate: 0.0000  # USDT 合约手续费率 0.02%
  
  bitget:
  #BITGET 用我链接开户每笔交易省20%手续费 邀请码【opensqt】开户链接：https://partner.hdmune.cn/bg/mtm6553a
    api_key: ""               # 或设置环境变量 BITGET_API_KEY
    secret_key: ""            # 或设置环境变量 BITGET_SECRET_KEY
    passphrase: ""            # 或设置环境变量 BITGET_PASSPHRASE
    fee_rate: 0.0002

  bybit:
  #BYBIT 开户邀请码【OPENSQT】开户链接：https://partner.bybit.com/b/OPENSQT
    api_key: ""               # 或设置环境变量 BYBIT_API_KEY
    secret_key: ""            # 或设置环境变量 BYBIT_SECRET_KEY
    fee_rate: 0.0002

  gate:
  #GATE.IO 用我链接开户每笔交易省20%手续费 邀请码【OPENSQTC】开户链接：https://www.gatenode.xyz/share/OPENSQTC
    api_key: ""               # 或设置环境变量 GATE_API_KEY
    secret_key: ""            # 或设置环境变量 GATE_SECRET_KEY
    fee_rate: 0.0002

  edgex:
  #EDGEX 用我链接开户直升vip1,每笔交易省20%手续费 邀请码【OPENSQT】开户链接：https://pro.edgex.exchange/referral/OPENSQT
    api_key: ""               # 或设置环境变量 EDGEX_API_KEY
    secret_key: ""            # 或设置环境变量 EDGEX_SECRET_KEY
    fee_rate: 0.0002
    
  bit:
  #bit.com 用我链接开户,每笔交易省50%手续费 邀请码【OPENSQT】开户链接：https://bitweb.bitexch.io/zh-CN/signup?code=OPENSQT
    api_key: ""               # 或设置环境变量 BIT_API_KEY
    secret_key: ""            # 或设置环境变量 BIT_SECRET_KEY
    fee_rate: 0.0002
####################################

trading:
  symbol: "DOGEUSDC"
  price_interval: 0.00001         # 价格间隔（1美元）
  order_quantity: 24        # 每单购买金额（USDT/USDC）如 30 表示每单投入30U
  min_order_value: 6      # 最小订单价值（USDT），小于此值不挂单（默认20U）
  # 注意：price_decimals 和 quantity_decimals 已移除，现在从交易所自动获取
  
  #ETH配置建议(每单赚1美分):
  #价格间隔：1 美元
  #订单金额：30 USDT（每单投入30U，价格3000时买0.01 ETH，价格1500时买0.02 ETH）
  #价格小数位数：2
  #数量小数位数：3

  #ETH配置建议(每单赚10美分):
  #价格间隔：10 美元
  #订单金额：300 USDT (每单投入300U，需要大量保证金)
  #价格小数位数：2

  #DOGE建议（每单赚2美分）：
  #价格间隔：0.0001 美元
  #订单金额：20 USDT（价格0.1时买200 DOGE，价格0.2时买100 DOGE）
  #价格小数位数：6

#####################################

  # 滑动窗口配置
  buy_window_size: 40          # 下方买单数量
  sell_window_size: 40         # 上方卖单数量

  # 对账配置
  reconcile_interval: 60      # 对账间隔（秒）

  # 订单管理配置
  order_cleanup_threshold: 90      # 订单清理上限（超过此数量时触发清理）
  cleanup_batch_size: 45           # 清理批次大小（每次清理的买单和卖单数量）
  margin_lock_duration_seconds: 20  # 保证金不足时锁定时间（秒，默认10秒）
  
  # 持仓安全性配置
  position_safety_check: 6        # 持仓安全性检查（默认100，最少能向下持有多少仓）

  # 动态网格配置（根据波动率自动调整网格密度）
  dynamic_grid:
    enabled: true                  # 是否启用动态网格（默认关闭，使用固定间距）
    atr_period: 14                  # ATR计算周期（默认14根K线）
    atr_interval: "5m"              # ATR使用的K线周期（1m/5m/15m，默认5m）
    atr_multiplier: 0.9             # ATR乘数（默认0.9，值越大网格越宽）
    min_profit_rate: 0.001          # 最小利润率（默认0.1%，确保每单有利润）
    # 
    # 动态网格计算逻辑：
    # 实际间距 = max(基础间距, 保本间距, ATR间距)
    # - 基础间距: 配置的 price_interval 值
    # - 保本间距: 当前价格 × (手续费率×2 + 最小利润率)
    # - ATR间距: ATR(14) × atr_multiplier
    #
    # 效果：
    # - 波动大时：ATR变大 -> 网格变宽 -> 避免频繁交易被套
    # - 波动小时：ATR变小 -> 网格变窄（但不低于保本间距）-> 抓取微小波动

  # 阴跌检测配置（均线压制 + 连续收阴）
  # 用于识别"钝刀子割肉"的缓慢下跌行情，防止在阴跌中把子弹打光
  downtrend_detection:
    enabled: true                  # 是否启用阴跌检测（默认关闭）
    ma_window: 20                   # 均线周期（默认20）
    mild_threshold: 0.99            # 轻度下跌阈值（价格 < MA × 0.99，即低于均线1%）
    severe_threshold: 0.97         # 严重下跌阈值（价格 < MA × 0.96，即低于均线3%）
    consecutive_down_count: 3       # 连续收阴K线数（默认6根）
    mild_multiplier: 0.5            # 轻度下跌时买入数量乘数（打5折）
    severe_multiplier: 0.2          # 严重阴跌时买入数量乘数（打2折）
    severe_window_ratio: 0.1        # 严重阴跌时买单窗口比例（只挂30%的买单）
    kline_interval: "5m"            # K线周期（默认5分钟）
    #
    # 判定逻辑：
    # 1. 轻度下跌：当前价格 < MA20 × 0.98（被均线压制超过2%）
    #    → 买入数量 × 0.8
    # 2. 严重阴跌：价格 < MA20 × 0.985 且 连续6根K线收阴
    #    → 买入数量 × 0.6，买单窗口 × 0.3（保留现金等待企稳）

  # 中性合约网格配置（支持做空）
  neutral_grid:
    enabled: true                  # 是否启用中性网格（默认false）
    max_short_positions: 10         # 最大空仓数量（默认10）
    short_threshold: 1.006          # 开空仓阈值（默认1.002，价格>MA×1.002）
    short_ma_window: 20             # 开空仓均线周期（默认20）
    short_close_rate: 0.003         # 空仓平仓利润率（默认0.005即0.5%）
    #
    # 判定逻辑：
    # 1. 开空仓：当前价格 > MA20 × 1.002（价格高于均线0.2%）
    #    → 在当前价格上方开空仓
    # 2. 平空仓：价格下跌到开仓价下方，且利润率 >= 0.5%
    #    → 平空仓获利
    #
    # 注意：现在开空仓需要同时满足 crash_detection 条件
    # 即：单边上涨趋势 + 暴跌 → 才允许开空仓

  # 暴跌检测配置（单边上涨趋势中的暴跌）
  crash_detection:
    enabled: true                   # 是否启用暴跌检测（默认false）
    ma_window: 20                   # 短期均线周期（默认20）
    long_ma_window: 60              # 长期均线周期（默认60）
    min_uptrend_candles: 5          # 最小连续上涨K线数（默认5）
    mild_crash_rate: 0.05           # 轻度暴跌幅度（默认0.05即5%）
    severe_crash_rate: 0.10         # 严重暴跌幅度（默认0.10即10%）
    kline_interval: "5m"            # K线周期（默认"1h"）
    #
    # 判定逻辑：
    # 1. 单边上涨趋势：MA20 > MA60 且 连续5根K线收阳（Close > Open）
    # 2. 暴跌：从最近10根K线最高点下跌超过5%（轻度）或10%（严重）
    # 3. 触发做空：单边上涨 + 暴跌 → 开空仓
    #
    # 使用场景：
    # - 在牛市中突然暴跌时，通过做空对冲风险
    # - 仅在检测到单边上涨趋势中的暴跌时才开启做空
    # - 未检测到暴跌时，只允许平空仓，不允许开空仓
    #
    # 注意：
    # - 量化交易使用短周期K线（如5分钟），这里统计的是连续上涨的K线数，不是天数
    # - 例如：kline_interval=5m, min_uptrend_candles=5 表示连续25分钟上涨


# 时间间隔配置
timing:
  # WebSocket相关
  websocket_reconnect_delay: 5      # WebSocket断线重连等待时间（秒，默认5）
  websocket_write_wait: 10          # WebSocket写入等待时间（秒，默认10）
  websocket_pong_wait: 60           # WebSocket PONG等待时间（秒，默认60）
  websocket_ping_interval: 20       # WebSocket PING间隔（秒，默认20）
  listen_key_keepalive_interval: 30 # listenKey保活间隔（分钟，默认30）

  # 价格监控相关
  price_send_interval: 50           # 定期发送价格的间隔（毫秒，默认50）

  # 订单执行相关
  rate_limit_retry_delay: 1         # 速率限制重试等待时间（秒，默认1）
  order_retry_delay: 500            # 其他错误重试等待时间（毫秒，默认500）
  price_poll_interval: 500          # 等待获取价格的轮询间隔（毫秒，默认500）
  status_print_interval: 1          # 定期打印状态的间隔（分钟，默认1）
  order_cleanup_interval: 10        # 订单清理检查间隔（秒，默认10）

system:
  # 日志级别: DEBUG(调试) / INFO(信息) / WARN(警告) / ERROR(错误) / FATAL(致命)
  # DEBUG: 输出所有日志，包括调试信息（最详细）
  # INFO: 输出一般信息、警告、错误和致命错误（推荐生产环境）
  # WARN: 只输出警告、错误和致命错误
  # ERROR: 只输出错误和致命错误
  # FATAL: 只输出致命错误
  log_level: "INFO"
  cancel_on_exit: true        # 退出时撤销所有订单（默认开启true,关闭用false）

# 主动安全风控配置（基于移动平均线）
risk_control:
  enabled: true
  monitor_symbols:
    - "BTCUSDT"
    - "ETHUSDT"
    - "SOLUSDT"
    - "XRPUSDT"
    - "DOGEUSDT"
  interval: "1m"
  volume_multiplier: 2.5
  average_window: 20
  trigger_threshold: 1      
  recovery_threshold: 4

  # 触发条件：当前价格 < 移动均价 且 成交量 > 均值×倍数
  # 解除条件：至少 recovery_threshold 个币种满足（当前价格 > 移动均价 且 成交量 < 均值×倍数）
